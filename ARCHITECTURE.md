# HtmlParserAgent æ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ParserAgent                             â”‚
â”‚                    (Agentç¼–æ’å™¨)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. è§„åˆ’é˜¶æ®µ (AgentPlanner)                          â”‚   â”‚
â”‚  â”‚     - åˆ†æURLåˆ—è¡¨                                     â”‚   â”‚
â”‚  â”‚     - æ¨æ–­åŸŸåå’Œå¸ƒå±€ç±»å‹                              â”‚   â”‚
â”‚  â”‚     - åˆ¶å®šæ‰§è¡Œè®¡åˆ’                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. æ‰§è¡Œé˜¶æ®µ (AgentExecutor)                         â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚     â”‚ å¯¹æ¯ä¸ªæ ·æœ¬URL:                              â”‚  â”‚   â”‚
â”‚  â”‚     â”‚  â‘  get_webpage_source()    â†’ HTML          â”‚  â”‚   â”‚
â”‚  â”‚     â”‚  â‘¡ capture_screenshot()    â†’ æˆªå›¾          â”‚  â”‚   â”‚
â”‚  â”‚     â”‚  â‘¢ extract_json_from_image() â†’ Schema      â”‚  â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚     â‘£ generate_parser_code() â†’ Pythonä»£ç            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. éªŒè¯é˜¶æ®µ (AgentValidator)                        â”‚   â”‚
â”‚  â”‚     - åŠ¨æ€åŠ è½½ç”Ÿæˆçš„è§£æå™¨                            â”‚   â”‚
â”‚  â”‚     - åœ¨æµ‹è¯•URLä¸Šè¿è¡Œ                                 â”‚   â”‚
â”‚  â”‚     - è®¡ç®—æˆåŠŸç‡                                      â”‚   â”‚
â”‚  â”‚     - è¯Šæ–­é—®é¢˜                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4. ä¼˜åŒ–é˜¶æ®µ (å¯é€‰)                                  â”‚   â”‚
â”‚  â”‚     - åˆ†æå¤±è´¥åŸå›                                     â”‚   â”‚
â”‚  â”‚     - ç”Ÿæˆæ”¹è¿›å»ºè®®                                    â”‚   â”‚
â”‚  â”‚     - è¿­ä»£ä¼˜åŒ–ä»£ç                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. Agentå±‚

```
ParserAgent (ç¼–æ’å™¨)
â”œâ”€â”€ AgentPlanner (è§„åˆ’å™¨)
â”‚   â””â”€â”€ LLMClient (Agentåœºæ™¯)
â”œâ”€â”€ AgentExecutor (æ‰§è¡Œå™¨)
â”‚   â”œâ”€â”€ get_webpage_source
â”‚   â”œâ”€â”€ capture_webpage_screenshot
â”‚   â”œâ”€â”€ extract_json_from_image
â”‚   â””â”€â”€ generate_parser_code
â””â”€â”€ AgentValidator (éªŒè¯å™¨)
    â””â”€â”€ LLMClient (Agentåœºæ™¯)
```

### 2. å·¥å…·å±‚

```
Tools
â”œâ”€â”€ webpage_source.py
â”‚   â””â”€â”€ DrissionPage (è·å–åŠ¨æ€HTML)
â”œâ”€â”€ webpage_screenshot.py
â”‚   â””â”€â”€ DrissionPage (é¡µé¢æˆªå›¾)
â”œâ”€â”€ visual_understanding.py
â”‚   â””â”€â”€ LLMClient (Visionåœºæ™¯ - qwen-vl-max)
â””â”€â”€ code_generator.py
    â””â”€â”€ LLMClient (CodeGenåœºæ™¯ - Claude)
```

### 3. åŸºç¡€è®¾æ–½å±‚

```
Infrastructure
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py (Pydanticé…ç½®ç®¡ç†)
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ llm_client.py (ç»Ÿä¸€LLMæ¥å£)
â””â”€â”€ .env (ç¯å¢ƒé…ç½®)
```

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â”‚
  â”œâ”€ URLs: ["url1", "url2", ...]
  â”œâ”€ domain: "example.com" (å¯é€‰)
  â””â”€ layout_type: "blog" (å¯é€‰)
  â”‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentPlanner                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è¾“å…¥: URLs, domain, layout_type â”‚ â”‚
â”‚ â”‚ è¾“å‡º: ExecutionPlan             â”‚ â”‚
â”‚ â”‚  - sample_urls: [url1, url2]   â”‚ â”‚
â”‚ â”‚  - steps: [fetch, screenshot,  â”‚ â”‚
â”‚ â”‚           extract, generate]   â”‚ â”‚
â”‚ â”‚  - max_iterations: 5           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentExecutor                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å¯¹æ¯ä¸ªsample_url:               â”‚ â”‚
â”‚ â”‚   HTML â† get_webpage_source()  â”‚ â”‚
â”‚ â”‚   PNG  â† capture_screenshot()  â”‚ â”‚
â”‚ â”‚   JSON â† extract_json(PNG)     â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ åˆå¹¶æ‰€æœ‰æ ·æœ¬çš„Schema            â”‚ â”‚
â”‚ â”‚   â†“                             â”‚ â”‚
â”‚ â”‚ Pythonä»£ç  â† generate_code()   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AgentValidator                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åŠ è½½: generated_parser.py      â”‚ â”‚
â”‚ â”‚ æµ‹è¯•: æ‰€æœ‰URLs                  â”‚ â”‚
â”‚ â”‚ è®¡ç®—: success_rate             â”‚ â”‚
â”‚ â”‚ åˆ¤æ–­: passed = rate >= 0.8     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â†“
è¾“å‡ºç»“æœ
  â”œâ”€ parser_path: "output/parsers/generated_parser.py"
  â”œâ”€ config_path: "output/parsers/schema.json"
  â”œâ”€ success: True/False
  â””â”€ validation_result: {...}
```

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
- **LLMClient**: æ”¯æŒä¸åŒåœºæ™¯çš„æ¨¡å‹é…ç½®
  - Agentåœºæ™¯: claude-sonnet-4-5-20250929
  - CodeGenåœºæ™¯: claude-sonnet-4-5-20250929
  - Visionåœºæ™¯: qwen-vl-max

### 2. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method)
- **ParserAgent.generate_parser()**: å®šä¹‰å›ºå®šæµç¨‹
  1. è§„åˆ’ â†’ 2. æ‰§è¡Œ â†’ 3. éªŒè¯ â†’ 4. ä¼˜åŒ–

### 3. è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)
- **æ‰§è¡Œé˜¶æ®µ**: å·¥å…·æŒ‰é¡ºåºè°ƒç”¨
  - HTMLè·å– â†’ æˆªå›¾ â†’ Schemaæå– â†’ ä»£ç ç”Ÿæˆ

### 4. å·¥å‚æ¨¡å¼ (Factory Pattern)
- **LLMClient.for_scenario()**: æ ¹æ®åœºæ™¯åˆ›å»ºå®¢æˆ·ç«¯

## ğŸ” å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨Agentæ¶æ„ï¼Ÿ
- âœ… è‡ªä¸»è§„åˆ’å’Œå†³ç­–èƒ½åŠ›
- âœ… å¯ä»¥éªŒè¯å’Œè‡ªæˆ‘ä¼˜åŒ–
- âœ… é€‚åº”ä¸åŒç±»å‹çš„ç½‘é¡µ

### 2. ä¸ºä»€ä¹ˆåˆ†ç¦»è§„åˆ’ã€æ‰§è¡Œã€éªŒè¯ï¼Ÿ
- âœ… å•ä¸€èŒè´£åŸåˆ™
- âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- âœ… å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–æ¯ä¸ªç»„ä»¶

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨è§†è§‰æ¨¡å‹ï¼Ÿ
- âœ… ç†è§£é¡µé¢å¸ƒå±€å’Œè§†è§‰ç»“æ„
- âœ… ä¸ä¾èµ–HTMLæ ‡ç­¾çš„è¯­ä¹‰
- âœ… æ›´æ¥è¿‘äººç±»ç†è§£æ–¹å¼

### 4. ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯å™¨ï¼Ÿ
- âœ… ç¡®ä¿ç”Ÿæˆä»£ç çš„è´¨é‡
- âœ… å‘ç°æ½œåœ¨é—®é¢˜
- âœ… æä¾›æ”¹è¿›æ–¹å‘

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### å¹¶å‘å¤„ç†
- å¤šä¸ªURLå¯ä»¥å¹¶è¡Œå¤„ç†ï¼ˆå¾…å®ç°ï¼‰
- æˆªå›¾å’ŒHTMLè·å–å¯ä»¥å¹¶è¡Œ

### ç¼“å­˜ç­–ç•¥
- HTMLå’Œæˆªå›¾å¯ä»¥ç¼“å­˜
- Schemaå¯ä»¥å¤ç”¨

### æˆæœ¬ä¼˜åŒ–
- ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹è¿›è¡ŒéªŒè¯
- æ‰¹é‡å¤„ç†å‡å°‘APIè°ƒç”¨

## ğŸš€ æ‰©å±•ç‚¹

### 1. è‡ªå®šä¹‰è§„åˆ’å™¨
```python
class CustomPlanner(AgentPlanner):
    def create_plan(self, urls, domain, layout_type):
        # è‡ªå®šä¹‰è§„åˆ’é€»è¾‘
        pass
```

### 2. è‡ªå®šä¹‰éªŒè¯å™¨
```python
class CustomValidator(AgentValidator):
    def validate_parser(self, parser_path, test_urls):
        # è‡ªå®šä¹‰éªŒè¯é€»è¾‘
        pass
```

### 3. æ·»åŠ æ–°å·¥å…·
```python
# tools/custom_tool.py
def custom_tool(input):
    # å®ç°å·¥å…·é€»è¾‘
    pass
```

