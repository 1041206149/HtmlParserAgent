# HtmlParserAgent

æ™ºèƒ½ç½‘é¡µè§£æä»£ç ç”Ÿæˆå™¨ - é€šè¿‡AIè‡ªåŠ¨ç”Ÿæˆç½‘é¡µè§£æä»£ç 

---

## ğŸ“– ç›®å½•

- [1. ç®€ä»‹](#1-ç®€ä»‹)
- [2. åŸºæœ¬åŸç†](#2-åŸºæœ¬åŸç†)
- [3. å®‰è£…](#3-å®‰è£…)
- [4. ä½¿ç”¨](#4-ä½¿ç”¨)
  - [4.1 å‘½ä»¤è¡Œä½¿ç”¨](#41-å‘½ä»¤è¡Œä½¿ç”¨)
  - [4.2 APIä½¿ç”¨](#42-apiä½¿ç”¨)
- [5. æ ¸å¿ƒç‰¹æ€§](#5-æ ¸å¿ƒç‰¹æ€§)
- [6. é¡¹ç›®ç»“æ„](#6-é¡¹ç›®ç»“æ„)
- [7. é…ç½®è¯´æ˜](#7-é…ç½®è¯´æ˜)
- [8. æ¶æ„è®¾è®¡](#8-æ¶æ„è®¾è®¡)
- [9. è®¸å¯è¯](#9-è®¸å¯è¯)

---

## 1. ç®€ä»‹

### 1.1 é¡¹ç›®æ¦‚è¿°

**HtmlParserAgent** æ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å’Œè§†è§‰æ¨¡å‹ï¼ˆVLMï¼‰çš„æ™ºèƒ½Agentç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨åˆ†æç½‘é¡µç»“æ„å¹¶ç”Ÿæˆé«˜è´¨é‡çš„Pythonè§£æä»£ç ã€‚

### 1.2 æ ¸å¿ƒèƒ½åŠ›

åªéœ€æä¾›å‡ ä¸ªç¤ºä¾‹URLï¼ŒAgentå°±èƒ½è‡ªåŠ¨å®Œæˆï¼š

1. ğŸ“¸ **è‡ªåŠ¨è·å–ç½‘é¡µæºç å’Œæˆªå›¾** - ä½¿ç”¨DrissionPageè·å–å®Œæ•´é¡µé¢å†…å®¹
2. ğŸ” **ä½¿ç”¨è§†è§‰æ¨¡å‹åˆ†æé¡µé¢ç»“æ„** - é€šè¿‡qwen-vl-maxç†è§£é¡µé¢å¸ƒå±€å’Œæ•°æ®ç»“æ„
3. ğŸ’» **ç”Ÿæˆå¯ç›´æ¥ä½¿ç”¨çš„BeautifulSoupè§£æä»£ç ** - ä½¿ç”¨Claudeç”Ÿæˆé«˜è´¨é‡ã€å¯ç»´æŠ¤çš„ä»£ç 
4. âœ… **è‡ªåŠ¨éªŒè¯ç”Ÿæˆä»£ç çš„æ­£ç¡®æ€§** - åœ¨çœŸå®URLä¸Šæµ‹è¯•ç”Ÿæˆçš„ä»£ç 
5. ğŸ”„ **è¿­ä»£ä¼˜åŒ–ç›´åˆ°æ»¡è¶³è¦æ±‚** - è‡ªåŠ¨ä¿®å¤é”™è¯¯ï¼Œæå‡æˆåŠŸç‡

### 1.3 é€‚ç”¨åœºæ™¯

- âœ… æ‰¹é‡çˆ¬å–åŒç±»å‹ç½‘é¡µï¼ˆåšå®¢æ–‡ç« ã€äº§å“é¡µé¢ã€æ–°é—»åˆ—è¡¨ç­‰ï¼‰
- âœ… å¿«é€ŸåŸå‹å¼€å‘ï¼Œè‡ªåŠ¨ç”Ÿæˆè§£æä»£ç æ¡†æ¶
- âœ… ç½‘é¡µç»“æ„åˆ†æå’Œæ•°æ®æå–
- âœ… å‡å°‘æ‰‹åŠ¨ç¼–å†™è§£æä»£ç çš„æ—¶é—´

### 1.4 æŠ€æœ¯æ ˆ

- **LangChain 1.0** - Agentæ¡†æ¶å’Œå·¥å…·ç¼–æ’
- **Claude Sonnet 4.5** - ä»£ç ç”Ÿæˆå’Œä»»åŠ¡è§„åˆ’
- **Qwen VL Max** - è§†è§‰ç†è§£å’Œç»“æ„æå–
- **DrissionPage** - ç½‘é¡µæŠ“å–å’Œæˆªå›¾
- **BeautifulSoup + lxml** - ç›®æ ‡è§£æåº“

---

## 2. åŸºæœ¬åŸç†

### 2.1 å·¥ä½œæµç¨‹

HtmlParserAgent é‡‡ç”¨**å¤šé˜¶æ®µAgentæ¶æ„**ï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤è‡ªåŠ¨ç”Ÿæˆè§£æä»£ç ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ1: ä»»åŠ¡è§„åˆ’ (Planning)                                  â”‚
â”‚  â”œâ”€ åˆ†æURLåˆ—è¡¨                                              â”‚
â”‚  â”œâ”€ ç¡®å®šåŸŸåå’Œå¸ƒå±€ç±»å‹                                        â”‚
â”‚  â””â”€ ç”Ÿæˆæ‰§è¡Œè®¡åˆ’                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ2: ä»»åŠ¡æ‰§è¡Œ (Execution)                                 â”‚
â”‚  â”œâ”€ å¤„ç†æ¯ä¸ªæ ·æœ¬URL:                                         â”‚
â”‚  â”‚   â”œâ”€ è·å–HTMLæºç  (get_webpage_source)                   â”‚
â”‚  â”‚   â”œâ”€ æ•è·å…¨é¡µæˆªå›¾ (capture_webpage_screenshot)           â”‚
â”‚  â”‚   â””â”€ æå–JSON Schema (extract_json_from_image)           â”‚
â”‚  â”œâ”€ åˆå¹¶å¤šä¸ªæ ·æœ¬çš„Schema (æ™ºèƒ½è¯†åˆ«å¿…éœ€/å¯é€‰å­—æ®µ)              â”‚
â”‚  â””â”€ ç”Ÿæˆè§£æä»£ç  (generate_parser_code)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ3: ä»£ç éªŒè¯ (Validation)                                â”‚
â”‚  â”œâ”€ åœ¨æ‰€æœ‰URLä¸Šæµ‹è¯•ç”Ÿæˆçš„ä»£ç                                 â”‚
â”‚  â”œâ”€ è®¡ç®—æˆåŠŸç‡                                               â”‚
â”‚  â””â”€ æ”¶é›†é”™è¯¯ä¿¡æ¯                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ4: è¿­ä»£ä¼˜åŒ– (Iteration) - å¯é€‰                          â”‚
â”‚  â”œâ”€ å¦‚æœæˆåŠŸç‡ < é˜ˆå€¼ (é»˜è®¤80%):                             â”‚
â”‚  â”‚   â”œâ”€ åˆ†æå¤±è´¥åŸå›                                          â”‚
â”‚  â”‚   â”œâ”€ ä½¿ç”¨LLMä¿®å¤ä»£ç  (fix_parser_code)                   â”‚
â”‚  â”‚   â”œâ”€ é‡æ–°éªŒè¯                                             â”‚
â”‚  â”‚   â””â”€ æ¯”è¾ƒæˆåŠŸç‡ (æå‡â†’ç»§ç»­ï¼Œä¸‹é™â†’å›æ»š)                    â”‚
â”‚  â””â”€ é‡å¤ç›´åˆ°è¾¾åˆ°é˜ˆå€¼æˆ–æœ€å¤§è¿­ä»£æ¬¡æ•°                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    ç”Ÿæˆçš„è§£æå™¨ä»£ç 
```

### 2.2 æ ¸å¿ƒæŠ€æœ¯

#### 2.2.1 å¤šURLæ ·æœ¬å¤„ç†

- æ”¯æŒåŒæ—¶å¤„ç†**ä»»æ„æ•°é‡**çš„URLæ ·æœ¬
- æ¯ä¸ªURLç‹¬ç«‹æå–HTMLã€æˆªå›¾å’ŒSchema
- å®¹é”™è®¾è®¡ï¼šå•ä¸ªæ ·æœ¬å¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹

#### 2.2.2 æ™ºèƒ½Schemaåˆå¹¶

å½“æä¾›å¤šä¸ªURLæ—¶ï¼Œç³»ç»Ÿä¼šï¼š

1. ç»Ÿè®¡æ¯ä¸ªå­—æ®µåœ¨æ‰€æœ‰æ ·æœ¬ä¸­çš„å‡ºç°é¢‘ç‡
2. å‡ºç°é¢‘ç‡ â‰¥ 50% â†’ æ ‡è®°ä¸º**å¿…éœ€å­—æ®µ**
3. å‡ºç°é¢‘ç‡ < 50% â†’ æ ‡è®°ä¸º**å¯é€‰å­—æ®µ**
4. ç”ŸæˆåŒ…å«æ‰€æœ‰å­—æ®µçš„é€šç”¨è§£æå™¨

**ç¤ºä¾‹**ï¼š
```
æ ·æœ¬1: 8ä¸ªå­—æ®µ  (title, author, date, content, ...)
æ ·æœ¬2: 6ä¸ªå­—æ®µ  (title, author, error_code, ...)
æ ·æœ¬3: 16ä¸ªå­—æ®µ (title, author, date, tags, comments, ...)

åˆå¹¶å: 25ä¸ªå­—æ®µ
  - å¿…éœ€å­—æ®µ: title, author (å‡ºç°åœ¨æ‰€æœ‰æ ·æœ¬)
  - å¯é€‰å­—æ®µ: error_code (ä»…å‡ºç°åœ¨æ ·æœ¬2)
```

#### 2.2.3 è§†è§‰ç†è§£é©±åŠ¨

ä½¿ç”¨**å¤šæ¨¡æ€å¤§æ¨¡å‹**ï¼ˆqwen-vl-maxï¼‰åˆ†æé¡µé¢æˆªå›¾ï¼š

- è¯†åˆ«é¡µé¢å¸ƒå±€å’Œç»“æ„
- æå–æ•°æ®å­—æ®µå’Œç±»å‹
- ç†è§£å­—æ®µä¹‹é—´çš„å…³ç³»
- ç”Ÿæˆç»“æ„åŒ–çš„JSON Schema

#### 2.2.4 è‡ªåŠ¨è¿­ä»£ä¼˜åŒ–

å½“éªŒè¯å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šï¼š

1. æ”¶é›†è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ˆåŒ…æ‹¬tracebackï¼‰
2. è°ƒç”¨LLMåˆ†æé”™è¯¯åŸå› 
3. ç”Ÿæˆä¿®å¤åçš„ä»£ç 
4. é‡æ–°éªŒè¯å¹¶æ¯”è¾ƒæˆåŠŸç‡
5. å¦‚æœæˆåŠŸç‡æå‡â†’æ¥å—ä¿®æ”¹ï¼Œå¦åˆ™â†’å›æ»š

### 2.3 å…³é”®ä¼˜åŠ¿

- âœ… **å®Œå…¨è‡ªåŠ¨åŒ–** - æ— éœ€æ‰‹åŠ¨ç¼–å†™è§£æä»£ç 
- âœ… **æ™ºèƒ½åŒ–** - LLMé©±åŠ¨çš„è§„åˆ’ã€ç”Ÿæˆå’Œä¿®å¤
- âœ… **å¯æ‰©å±•** - æ”¯æŒä»»æ„æ•°é‡çš„URLï¼Œæ˜“äºæ‰©å±•
- âœ… **å¥å£®æ€§** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨å›æ»šæœºåˆ¶

---

## 3. å®‰è£…

### 3.1 ç¯å¢ƒè¦æ±‚

- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **æµè§ˆå™¨**: Chrome/Chromiumï¼ˆç”¨äºç½‘é¡µæˆªå›¾ï¼‰
- **æ“ä½œç³»ç»Ÿ**: macOS, Linux, Windows

### 3.2 å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/HtmlParserAgent.git
cd HtmlParserAgent
```

### 3.3 å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

**ä¸»è¦ä¾èµ–**ï¼š
```
langchain>=0.3.0
langchain-core>=0.3.0
langchain-openai>=0.2.0
langchain-anthropic>=0.3.0
DrissionPage>=4.0.0
beautifulsoup4>=4.12.0
lxml>=4.9.0
loguru>=0.7.0
pydantic>=2.0.0
python-dotenv>=1.0.0
```

### 3.4 é…ç½®APIå¯†é’¥

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶é…ç½®APIå¯†é’¥ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
# APIé…ç½®
OPENAI_API_KEY=your_api_key_here
OPENAI_API_BASE=http://your_base_url/v1

# æ¨¡å‹é…ç½®
AGENT_MODEL=claude-sonnet-4-5-20250929      # Agentä½¿ç”¨çš„æ¨¡å‹
CODE_GEN_MODEL=claude-sonnet-4-5-20250929   # ä»£ç ç”Ÿæˆæ¨¡å‹
VISION_MODEL=qwen-vl-max                     # è§†è§‰ç†è§£æ¨¡å‹

# Agenté…ç½®
MAX_ITERATIONS=5          # æœ€å¤§è¿­ä»£æ¬¡æ•°
SUCCESS_THRESHOLD=0.8     # éªŒè¯æˆåŠŸé˜ˆå€¼ï¼ˆ80%ï¼‰
MIN_SAMPLE_SIZE=2         # æœ€å°æ ·æœ¬æ•°é‡
```

### 3.5 éªŒè¯å®‰è£…

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_setup.py
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼š

```
âœ“ é€šè¿‡ - æ¨¡å—å¯¼å…¥
âœ“ é€šè¿‡ - é…ç½®æ£€æŸ¥
âœ“ é€šè¿‡ - ç›®å½•ç»“æ„
âœ“ é€šè¿‡ - Agentåˆ›å»º

æ€»è®¡: 4/4 é€šè¿‡
```

---

## 4. ä½¿ç”¨

### 4.1 å‘½ä»¤è¡Œä½¿ç”¨

#### 4.1.1 åŸºæœ¬ç”¨æ³•

```bash
# æŸ¥çœ‹å¸®åŠ©
python main.py -h

# å•ä¸ªURLï¼ˆæµ‹è¯•ç”¨ï¼‰
python main.py https://example.com/article

# å¤šä¸ªURLï¼ˆç›´æ¥æŒ‡å®šï¼‰
python main.py https://example.com/article1 https://example.com/article2

# ä»æ–‡ä»¶è¯»å–URLåˆ—è¡¨ï¼ˆæ¨èï¼Œé€‚åˆå¤šURLåœºæ™¯ï¼‰
python main.py -f urls.txt

# æŒ‡å®šè¾“å‡ºç›®å½•å’Œé¡µé¢ç±»å‹
python main.py -f urls.txt -o output/blog -t blog_article

# è·³è¿‡éªŒè¯ï¼Œå¿«é€Ÿç”Ÿæˆ
python main.py -f urls.txt --no-validate
```

#### 4.1.2 URLæ–‡ä»¶æ ¼å¼

åˆ›å»ºä¸€ä¸ª `urls.txt` æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªURLï¼š

```text
# URLåˆ—è¡¨ç¤ºä¾‹
# æ¯è¡Œä¸€ä¸ªURLï¼Œä»¥ # å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Š

https://stackoverflow.blog/2025/10/15/secure-coding-in-javascript/
https://stackoverflow.blog/2024/12/18/you-should-keep-a-developer-changelog/
https://stackoverflow.blog/2024/11/13/your-docs-are-your-infrastructure/
```

#### 4.1.3 ä½¿ç”¨ç”Ÿæˆçš„è§£æå™¨

```bash
# è§£ææ–°çš„URL
python output/blog/parsers/generated_parser.py https://example.com/new-article

# è§£ææœ¬åœ°HTMLæ–‡ä»¶
python output/blog/parsers/generated_parser.py path/to/file.html
```

---

### 4.2 APIä½¿ç”¨

#### 4.2.1 åŸºæœ¬ç”¨æ³•

```python
from agent import ParserAgent

# åˆ›å»ºAgentå®ä¾‹
agent = ParserAgent(output_dir="output/blog")

# å‡†å¤‡URLåˆ—è¡¨ï¼ˆå»ºè®®2-5ä¸ªåŒç±»å‹URLï¼‰
urls = [
    "https://example.com/article1",
    "https://example.com/article2",
    "https://example.com/article3",
]

# ç”Ÿæˆè§£æå™¨
result = agent.generate_parser(
    urls=urls,
    domain="example.com",         # å¯é€‰ï¼Œè‡ªåŠ¨ä»URLæå–
    layout_type="blog_article",   # å¯é€‰ï¼Œé¡µé¢ç±»å‹æè¿°
    validate=True                  # æ˜¯å¦éªŒè¯ç”Ÿæˆçš„ä»£ç 
)

# æ£€æŸ¥ç»“æœ
if result['success']:
    print(f"âœ“ è§£æå™¨: {result['parser_path']}")
    print(f"âœ“ æˆåŠŸç‡: {result['validation_result']['success_rate']:.1%}")
else:
    print(f"âœ— å¤±è´¥: {result.get('error', 'Unknown error')}")
```

#### 4.2.2 ä»æ–‡ä»¶è¯»å–URL

```python
from agent import ParserAgent

# è¯»å–URLæ–‡ä»¶
with open('urls.txt', 'r') as f:
    urls = [line.strip() for line in f if line.strip() and not line.startswith('#')]

# ç”Ÿæˆè§£æå™¨
agent = ParserAgent(output_dir="output/blog")
result = agent.generate_parser(urls=urls, validate=True)
```

#### 4.2.3 ä½¿ç”¨ç”Ÿæˆçš„è§£æå™¨

```python
import sys
sys.path.insert(0, 'output/blog/parsers')
from generated_parser import WebPageParser

# åˆ›å»ºè§£æå™¨å®ä¾‹
parser = WebPageParser()

# è§£æHTML
html = """<html>...</html>"""
data = parser.parse(html)
print(data)
```

#### 4.2.4 è¿”å›å€¼è¯´æ˜

`generate_parser()` è¿”å›ä¸€ä¸ªå­—å…¸ï¼š

```python
{
    'success': bool,              # æ˜¯å¦æˆåŠŸ
    'parser_path': str,           # ç”Ÿæˆçš„è§£æå™¨è·¯å¾„
    'config_path': str,           # é…ç½®æ–‡ä»¶è·¯å¾„
    'validation_result': {        # éªŒè¯ç»“æœï¼ˆå¦‚æœvalidate=Trueï¼‰
        'success': bool,
        'success_rate': float,    # æˆåŠŸç‡ (0.0-1.0)
        'tests': [...]            # æµ‹è¯•ç»“æœåˆ—è¡¨
    },
    'error': str                  # é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰
}
```

---

## 5. æ ¸å¿ƒç‰¹æ€§

### 5.1 å¤šURLæ ·æœ¬å¤„ç†

- âœ… æ”¯æŒåŒæ—¶å¤„ç†**ä»»æ„æ•°é‡**çš„URL
- âœ… æ¯ä¸ªURLç‹¬ç«‹æå–HTMLã€æˆªå›¾å’ŒSchema
- âœ… å®¹é”™è®¾è®¡ï¼šå•ä¸ªæ ·æœ¬å¤±è´¥ä¸å½±å“æ•´ä½“
- âœ… å®Œå…¨å¯æ‰©å±•çš„æ¶æ„

### 5.2 æ™ºèƒ½Schemaåˆå¹¶

- âœ… è‡ªåŠ¨ç»Ÿè®¡å­—æ®µå‡ºç°é¢‘ç‡
- âœ… è¯†åˆ«å¿…éœ€å­—æ®µï¼ˆå‡ºç°â‰¥50%æ ·æœ¬ï¼‰
- âœ… è¯†åˆ«å¯é€‰å­—æ®µï¼ˆå‡ºç°<50%æ ·æœ¬ï¼‰
- âœ… ç”ŸæˆåŒ…å«æ‰€æœ‰å­—æ®µçš„é€šç”¨è§£æå™¨

### 5.3 è‡ªåŠ¨è¿­ä»£ä¼˜åŒ–

- âœ… éªŒè¯å¤±è´¥æ—¶è‡ªåŠ¨è§¦å‘
- âœ… LLMé©±åŠ¨çš„ä»£ç ä¿®å¤
- âœ… æ™ºèƒ½åˆ¤æ–­ä¿®å¤æ•ˆæœ
- âœ… è‡ªåŠ¨å›æ»šæœºåˆ¶
- âœ… æ”¯æŒæœ€å¤š5è½®è¿­ä»£

### 5.4 è§†è§‰ç†è§£

- âœ… ä½¿ç”¨å¤šæ¨¡æ€å¤§æ¨¡å‹åˆ†æé¡µé¢
- âœ… è¯†åˆ«é¡µé¢å¸ƒå±€å’Œç»“æ„
- âœ… æå–æ•°æ®å­—æ®µå’Œç±»å‹
- âœ… ç”Ÿæˆç»“æ„åŒ–JSON Schema

### 5.5 é«˜è´¨é‡ä»£ç ç”Ÿæˆ

- âœ… ä½¿ç”¨Claudeç”Ÿæˆä»£ç 
- âœ… ç¬¦åˆPEP 8è§„èŒƒ
- âœ… åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… å¯ç›´æ¥ä½¿ç”¨çš„BeautifulSoupä»£ç 

---

## 6. é¡¹ç›®ç»“æ„

```
HtmlParserAgent/
â”œâ”€â”€ agent/                          # Agentæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ planner.py                 # ä»»åŠ¡è§„åˆ’å™¨ (AgentPlanner)
â”‚   â”œâ”€â”€ executor.py                # ä»»åŠ¡æ‰§è¡Œå™¨ (AgentExecutor)
â”‚   â”œâ”€â”€ validator.py               # ä»£ç éªŒè¯å™¨ (AgentValidator)
â”‚   â””â”€â”€ orchestrator.py            # Agentç¼–æ’å™¨ (ParserAgent)
â”‚
â”œâ”€â”€ tools/                          # å·¥å…·æ¨¡å— (LangChain Tools)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ webpage_source.py          # ç½‘é¡µæºç è·å–å·¥å…·
â”‚   â”œâ”€â”€ webpage_screenshot.py      # ç½‘é¡µæˆªå›¾å·¥å…·
â”‚   â”œâ”€â”€ visual_understanding.py    # è§†è§‰ç†è§£å·¥å…·
â”‚   â”œâ”€â”€ code_generator.py          # ä»£ç ç”Ÿæˆå·¥å…·
â”‚   â””â”€â”€ code_fixer.py              # ä»£ç ä¿®å¤å·¥å…·
â”‚
â”œâ”€â”€ utils/                          # å·¥å…·ç±»
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ llm_client.py              # LLMå®¢æˆ·ç«¯å°è£…
â”‚
â”œâ”€â”€ config/                         # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py                # é…ç½®ç®¡ç† (Pydantic)
â”‚
â”œâ”€â”€ output/                         # è¾“å‡ºç›®å½•
â”‚   â””â”€â”€ [domain]/
â”‚       â”œâ”€â”€ screenshots/           # æˆªå›¾
â”‚       â”œâ”€â”€ parsers/               # ç”Ÿæˆçš„è§£æå™¨
â”‚       â””â”€â”€ configs/               # é…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ logs/                           # æ—¥å¿—ç›®å½•
â”‚
â”œâ”€â”€ main.py                        # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ example.py                     # ä½¿ç”¨ç¤ºä¾‹
â”‚
â”œâ”€â”€ requirements.txt               # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ .env.example                   # ç¯å¢ƒé…ç½®ç¤ºä¾‹
â”‚
â””â”€â”€ README.md                      # æœ¬æ–‡æ¡£

```

---

## 7. é…ç½®è¯´æ˜

### 7.1 ç¯å¢ƒå˜é‡é…ç½®

`.env` æ–‡ä»¶ä¸­çš„ä¸»è¦é…ç½®é¡¹ï¼š

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|--------|------|--------|--------|
| `OPENAI_API_KEY` | APIå¯†é’¥ | - | å¿…å¡« |
| `OPENAI_API_BASE` | APIåŸºç¡€URL | - | å¿…å¡« |
| `AGENT_MODEL` | Agentæ¨¡å‹ | claude-sonnet-4-5-20250929 | claude-sonnet-4-5-20250929 |
| `CODE_GEN_MODEL` | ä»£ç ç”Ÿæˆæ¨¡å‹ | claude-sonnet-4-5-20250929 | claude-sonnet-4-5-20250929 |
| `VISION_MODEL` | è§†è§‰æ¨¡å‹ | qwen-vl-max | qwen-vl-max |
| `MAX_ITERATIONS` | æœ€å¤§è¿­ä»£æ¬¡æ•° | 5 | 3-5 |
| `SUCCESS_THRESHOLD` | æˆåŠŸç‡é˜ˆå€¼ | 0.8 | 0.7-0.9 |
| `MIN_SAMPLE_SIZE` | æœ€å°æ ·æœ¬æ•° | 2 | 2-3 |

### 7.3 æ¨¡å‹é€‰æ‹©å»ºè®®

**ä»£ç ç”Ÿæˆæ¨¡å‹**ï¼š
- âœ… **Claude Sonnet 4.5** - æ¨èï¼Œä»£ç è´¨é‡é«˜

**è§†è§‰ç†è§£æ¨¡å‹**ï¼š
- âœ… **qwen-vl-max** - æ¨èï¼Œä¸­æ–‡æ”¯æŒå¥½

---

## 8. æ¶æ„è®¾è®¡

### 8.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ParserAgent                             â”‚
â”‚                    (Orchestrator)                            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Planner   â”‚â†’ â”‚  Executor  â”‚â†’ â”‚ Validator  â”‚            â”‚
â”‚  â”‚  ä»»åŠ¡è§„åˆ’   â”‚  â”‚  ä»»åŠ¡æ‰§è¡Œ   â”‚  â”‚  ä»£ç éªŒè¯   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                         â†“                â†“                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚                    â”‚  Iteration Loop     â”‚                  â”‚
â”‚                    â”‚  è¿­ä»£ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰    â”‚                  â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         LangChain Tools               â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  â€¢ get_webpage_source                 â”‚
        â”‚  â€¢ capture_webpage_screenshot         â”‚
        â”‚  â€¢ extract_json_from_image            â”‚
        â”‚  â€¢ generate_parser_code               â”‚
        â”‚  â€¢ fix_parser_code                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         External Services             â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚  â€¢ Claude Sonnet 4.5 (ä»£ç ç”Ÿæˆ)       â”‚
        â”‚  â€¢ Qwen VL Max (è§†è§‰ç†è§£)             â”‚
        â”‚  â€¢ DrissionPage (ç½‘é¡µæŠ“å–)            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 8.3 æ•°æ®æµ

```
URLs â†’ Planner â†’ Plan
                   â†“
Plan â†’ Executor â†’ Samples (HTML + Screenshot + Schema)
                   â†“
Samples â†’ Schema Merger â†’ Merged Schema
                            â†“
Merged Schema + HTML â†’ Code Generator â†’ Parser Code
                                          â†“
Parser Code â†’ Validator â†’ Validation Result
                            â†“
                    Success Rate < Threshold?
                            â†“
                    Yes â†’ Code Fixer â†’ Fixed Code â†’ Validator
                            â†“
                    No â†’ Final Parser
```

## 9. è®¸å¯è¯

MIT License

---

## ğŸ™ è‡´è°¢

- [LangChain](https://github.com/langchain-ai/langchain) - Agentæ¡†æ¶
- [DrissionPage](https://github.com/g1879/DrissionPage) - ç½‘é¡µæŠ“å–å·¥å…·

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æäº¤ [Issue](https://github.com/1041206149/HtmlParserAgent/issues)
- å‘é€é‚®ä»¶è‡³: 1041206149@qq.com

---

**æœ€åæ›´æ–°**: 2025-11-20
**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

