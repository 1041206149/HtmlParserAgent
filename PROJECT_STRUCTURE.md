# HtmlParserAgent é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
HtmlParserAgent/
â”œâ”€â”€ agent/                      # Agentæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py            # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ planner.py             # ä»»åŠ¡è§„åˆ’å™¨ - åˆ†æURLå¹¶åˆ¶å®šæ‰§è¡Œè®¡åˆ’
â”‚   â”œâ”€â”€ executor.py            # ä»»åŠ¡æ‰§è¡Œå™¨ - æ‰§è¡Œå…·ä½“çš„è§£æä»»åŠ¡
â”‚   â”œâ”€â”€ validator.py           # ä»£ç éªŒè¯å™¨ - éªŒè¯ç”Ÿæˆä»£ç çš„æ­£ç¡®æ€§
â”‚   â””â”€â”€ orchestrator.py        # Agentç¼–æ’å™¨ - æ•´åˆæ‰€æœ‰ç»„ä»¶
â”‚
â”œâ”€â”€ tools/                      # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py            # å·¥å…·å¯¼å‡º
â”‚   â”œâ”€â”€ webpage_source.py      # è·å–ç½‘é¡µHTMLæºç 
â”‚   â”œâ”€â”€ webpage_screenshot.py  # æ•è·ç½‘é¡µæˆªå›¾
â”‚   â”œâ”€â”€ visual_understanding.py # ä»æˆªå›¾æå–JSON Schema
â”‚   â””â”€â”€ code_generator.py      # ç”ŸæˆBeautifulSoupè§£æä»£ç 
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·ç±»
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ llm_client.py          # LLMå®¢æˆ·ç«¯å°è£…ï¼ˆæ”¯æŒå¤šåœºæ™¯ï¼‰
â”‚
â”œâ”€â”€ config/                     # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py            # é…ç½®ç®¡ç†ï¼ˆåŸºäºPydanticï¼‰
â”‚
â”œâ”€â”€ main.py                     # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ example.py                  # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ test_setup.py              # è®¾ç½®æµ‹è¯•è„šæœ¬
â”œâ”€â”€ requirements.txt           # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ .env                       # ç¯å¢ƒé…ç½®ï¼ˆä¸æäº¤åˆ°Gitï¼‰
â”œâ”€â”€ .gitignore                 # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. Agentæ¨¡å— (`agent/`)

#### AgentPlanner (è§„åˆ’å™¨)
- **èŒè´£**: åˆ†æä»»åŠ¡ï¼Œåˆ¶å®šæ‰§è¡Œè®¡åˆ’
- **è¾“å…¥**: URLåˆ—è¡¨ã€åŸŸåã€å¸ƒå±€ç±»å‹
- **è¾“å‡º**: æ‰§è¡Œè®¡åˆ’ï¼ˆåŒ…å«æ­¥éª¤ã€æ ·æœ¬URLã€éªŒè¯ç­–ç•¥ç­‰ï¼‰
- **å…³é”®æ–¹æ³•**: `create_plan(urls, domain, layout_type)`

#### AgentExecutor (æ‰§è¡Œå™¨)
- **èŒè´£**: æ‰§è¡Œå…·ä½“çš„è§£æä»»åŠ¡
- **æµç¨‹**: 
  1. è·å–HTMLæºç 
  2. æ•è·é¡µé¢æˆªå›¾
  3. æå–JSON Schema
  4. ç”Ÿæˆè§£æä»£ç 
- **å…³é”®æ–¹æ³•**: `execute_plan(plan)`

#### AgentValidator (éªŒè¯å™¨)
- **èŒè´£**: éªŒè¯ç”Ÿæˆä»£ç çš„æ­£ç¡®æ€§
- **åŠŸèƒ½**:
  - åŠ¨æ€åŠ è½½ç”Ÿæˆçš„è§£æå™¨
  - åœ¨æµ‹è¯•URLä¸Šè¿è¡Œè§£æå™¨
  - è®¡ç®—æˆåŠŸç‡
  - è¯Šæ–­é—®é¢˜å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®
- **å…³é”®æ–¹æ³•**: `validate_parser(parser_path, test_urls)`

#### ParserAgent (ç¼–æ’å™¨)
- **èŒè´£**: æ•´åˆæ‰€æœ‰ç»„ä»¶ï¼Œæä¾›ç»Ÿä¸€æ¥å£
- **æµç¨‹**:
  1. è§„åˆ’ â†’ 2. æ‰§è¡Œ â†’ 3. éªŒè¯ â†’ 4. ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
- **å…³é”®æ–¹æ³•**: `generate_parser(urls, domain, layout_type, validate)`

### 2. å·¥å…·æ¨¡å— (`tools/`)

#### get_webpage_source
- ä½¿ç”¨DrissionPageè·å–ç½‘é¡µHTMLæºç 
- æ”¯æŒJavaScriptæ¸²æŸ“çš„åŠ¨æ€é¡µé¢

#### capture_webpage_screenshot
- æ•è·ç½‘é¡µå…¨é¡µæˆ–å¯è§†åŒºåŸŸæˆªå›¾
- æ”¯æŒè‡ªå®šä¹‰çª—å£å¤§å°

#### extract_json_from_image
- ä½¿ç”¨è§†è§‰æ¨¡å‹ï¼ˆqwen-vl-maxï¼‰åˆ†ææˆªå›¾
- æå–é¡µé¢ç»“æ„åŒ–ä¿¡æ¯ï¼ˆJSON Schemaï¼‰

#### generate_parser_code
- åŸºäºHTMLå’ŒJSON Schemaç”Ÿæˆè§£æä»£ç 
- ä½¿ç”¨Claudeç”Ÿæˆé«˜è´¨é‡BeautifulSoupä»£ç 

### 3. é…ç½®ç³»ç»Ÿ (`config/`)

#### Settings
- åŸºäºPydanticçš„é…ç½®ç®¡ç†
- ä».envæ–‡ä»¶åŠ è½½é…ç½®
- æ”¯æŒå¤šåœºæ™¯æ¨¡å‹é…ç½®ï¼š
  - Agentåœºæ™¯: claude-sonnet-4-5-20250929
  - ä»£ç ç”Ÿæˆ: claude-sonnet-4-5-20250929
  - è§†è§‰ç†è§£: qwen-vl-max

### 4. LLMå®¢æˆ·ç«¯ (`utils/llm_client.py`)

#### LLMClient
- ç»Ÿä¸€çš„LLMè°ƒç”¨æ¥å£
- æ”¯æŒåœºæ™¯åŒ–é…ç½®ï¼š
  - `LLMClient.for_scenario("agent")` - Agentåœºæ™¯
  - `LLMClient.for_scenario("code_gen")` - ä»£ç ç”Ÿæˆ
  - `LLMClient.for_scenario("vision")` - è§†è§‰ç†è§£
- æ–¹æ³•ï¼š
  - `chat_completion()` - æ–‡æœ¬å¯¹è¯
  - `vision_completion()` - è§†è§‰ç†è§£

## ğŸ”„ å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥URLåˆ—è¡¨
    â†“
[AgentPlanner] åˆ†æä»»åŠ¡ï¼Œåˆ¶å®šè®¡åˆ’
    â†“
[AgentExecutor] æ‰§è¡Œè®¡åˆ’
    â”œâ”€ è·å–HTMLæºç  (get_webpage_source)
    â”œâ”€ æ•è·æˆªå›¾ (capture_webpage_screenshot)
    â”œâ”€ æå–Schema (extract_json_from_image)
    â””â”€ ç”Ÿæˆä»£ç  (generate_parser_code)
    â†“
[AgentValidator] éªŒè¯ä»£ç 
    â”œâ”€ åŠ è½½è§£æå™¨
    â”œâ”€ æµ‹è¯•URL
    â”œâ”€ è®¡ç®—æˆåŠŸç‡
    â””â”€ è¯Šæ–­é—®é¢˜
    â†“
[ParserAgent] è¾“å‡ºç»“æœ
    â”œâ”€ è§£æå™¨ä»£ç è·¯å¾„
    â”œâ”€ é…ç½®æ–‡ä»¶è·¯å¾„
    â””â”€ éªŒè¯æŠ¥å‘Š
```

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–**: æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤
2. **å¯æ‰©å±•**: é€šè¿‡ç»§æ‰¿å’Œç»„åˆè½»æ¾æ‰©å±•åŠŸèƒ½
3. **é…ç½®é©±åŠ¨**: æ‰€æœ‰å…³é”®å‚æ•°é€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†
4. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
5. **ç±»å‹å®‰å…¨**: ä½¿ç”¨Pydanticè¿›è¡Œé…ç½®éªŒè¯

## ğŸ“ ä½¿ç”¨å»ºè®®

1. **å¿«é€Ÿå¼€å§‹**: ä½¿ç”¨`main.py`æˆ–`example.py`
2. **è‡ªå®šä¹‰**: ç»§æ‰¿Agentç±»å®ç°ç‰¹å®šéœ€æ±‚
3. **è°ƒè¯•**: æŸ¥çœ‹`logs/`ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
4. **ä¼˜åŒ–**: æ ¹æ®éªŒè¯ç»“æœæ‰‹åŠ¨è°ƒæ•´ç”Ÿæˆçš„ä»£ç 

